# 总结当前对话里面的核心需求

- 目标：解决 Google 未收录大量页面的问题，统一规范 URL（尾斜杠）、为每页设置唯一 canonical，允许抓取 auth 但 noindex，完善 sitemap，并加强站内内链。

## 目录
- [需求背景](#需求背景)
- [设计方案](#设计方案)
- [代码实现](#代码实现)
- [测试方案](#测试方案)

## 需求背景
- GSC 显示仅收录少量页面，且出现 http 与 https、无尾斜杠与尾斜杠混用、以及 /auth/* 被 robots 层面拦截等问题。
- 默认全局 canonical 指向首页，导致大量页面被判定为“重复内容（已选择不同规范 URL）”。

## 设计方案
- 规范 URL：统一使用尾斜杠（trailingSlash: true），所有 canonical 与 sitemap 保持一致。
- canonical 策略：移除全局 canonical，改为每个页面独立设置；首页单独在 page.tsx 设置 `/`。
- robots 策略：robots.txt 允许抓取 /auth/*；新增 `src/app/auth/layout.tsx` 设置 robots noindex、nofollow，防止索引但允许抓取。
- Sitemap：全部 URL 加尾斜杠，补充缺失的 `/license/`；与站点实际路由一一对应。
- 内链增强：主页 FeaturesSection 卡片直接链接至 4 个功能子页，提升发现与聚合信号。

## 代码实现
- 移除默认 canonical：`src/lib/metadata.ts` 删除 `alternates.canonical`。
- 首页 canonical：`src/app/page.tsx` 新增 `export const metadata.alternates.canonical = '/'`。
- 页面 canonical：
  - `src/lib/page-metadata.ts` 中所有 `openGraph.url` 统一加尾斜杠（pricing、download、faq、docs、releases、requirements、privacy、terms、refunds）。
  - `src/app/features/page.tsx`、`src/app/features/*/page.tsx`、`src/app/license/page.tsx` 增加各自 canonical。
- 允许抓取但不索引 auth：
  - `src/app/robots.ts` 移除 `/auth/` 的 disallow。
  - 新增 `src/app/auth/layout.tsx`，设置 robots noindex/nofollow。
- Sitemap 统一：`src/app/sitemap.ts` 所有 URL 加尾斜杠，并补充 `/license/`。
- 内链增强：`src/components/FeaturesSection.tsx` 为 4 张卡片添加跳转（hotkeys、always-on-top、lightweight、screencapturekit）。

## 测试方案
- 本地校验：
  - `npm run type-check`（通过）
  - 访问 `http://localhost:3000/sitemap.xml` 检查所有 URL 均以 `/` 结尾。
  - 查看页面 `<link rel="canonical">` 是否为对应带尾斜杠 URL（首页为 `/`）。
  - 打开任一 /auth 页面，确认响应头/HTML 中包含 robots noindex（允许抓取但不索引）。
- GSC 操作：
  - 确保属性为“域名属性（DNS 验证）”。
  - 重新提交站点地图：`https://topwindow.app/sitemap.xml`。
  - 对关键页面（/features/、/features/always-on-top/、/download/、/pricing/）使用“URL 检查 → 请求编入索引”。
  - 监控“页面 → 已编入索引的网页数量”与“覆盖率 → 重复内容已选其他规范 URL”的趋势变化。

```markdown
// TESTING-GUIDE:
// 1. 输入 null 时的行为：无（纯静态配置）
// 2. 边界值验证：检查 http → https 301 是否稳定；无尾斜杠访问是否 308 → 有尾斜杠；canonical 与最终 URL 完全一致
// 3. 错误路径测试：/auth/* 页面不应出现在“已编入索引”，但“抓取”应为允许状态
```

