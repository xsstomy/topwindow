# License Key 系统测试指南

## 📋 概览

这个测试页面允许你验证TopWindow License Key管理系统的核心功能，无需完整的支付流程或生产环境配置。

## 🚀 快速开始

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 访问测试页面
打开浏览器访问：`http://localhost:3000/test-license`

### 3. 开始测试
按照页面上的说明进行各项功能测试。

## 🧪 测试功能说明

### License Key 生成器测试

#### 功能说明
- 测试License Key的生成算法
- 验证生成的密钥格式是否正确
- 测试批量生成和唯一性保证

#### 测试步骤
1. 点击"生成新密钥"按钮
2. 验证生成的密钥格式为：`TW-XXXX-XXXX-XXXX-XXXX`
3. 点击"批量生成(5个)"测试批量生成
4. 检查所有生成的密钥是否唯一且格式正确

#### 预期结果
- ✅ 所有密钥都遵循TW-前缀格式
- ✅ 每个密钥都包含正确的校验码
- ✅ 批量生成的密钥都是唯一的
- ✅ 可以成功复制密钥到剪贴板

### 格式验证器测试

#### 功能说明
- 测试License Key格式验证逻辑
- 验证有效和无效格式的识别

#### 测试步骤
1. 在输入框中输入有效的License Key（如：TW-A1B2-C3D4-E5F6-G7H8）
2. 查看验证结果是否显示"有效"
3. 输入无效格式（如：INVALID-KEY）
4. 查看验证结果是否显示"无效"
5. 使用快速测试用例按钮测试预定义的用例

#### 预期结果
- ✅ 有效格式被正确识别
- ✅ 无效格式被正确拒绝
- ✅ 实时验证响应迅速
- ✅ 校验码验证正常工作

### 输入验证器测试

#### 功能说明
- 测试各种输入格式的验证逻辑
- 验证设备ID、邮箱、设备信息等格式

#### 测试步骤
1. 点击"运行验证测试"按钮
2. 查看所有测试用例的结果
3. 确认各种验证器都正常工作

#### 预期结果
- ✅ License Key格式验证：有效用例通过，无效用例被拒绝
- ✅ 设备ID格式验证：符合8-64字符要求
- ✅ 邮箱格式验证：标准邮箱格式识别
- ✅ 激活请求验证：完整请求结构验证

### 数据库连接测试

#### 功能说明
- 测试Supabase数据库连接
- 验证基本的数据查询功能

#### 前置条件
确保环境变量正确配置：
```bash
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

#### 测试步骤
1. 点击"测试 Supabase 连接"按钮
2. 查看连接状态和返回信息

#### 预期结果
- ✅ 连接成功：显示绿色成功消息和产品记录数量
- ❌ 连接失败：显示红色错误信息和具体错误原因

## 🔧 故障排除

### 常见问题

#### 1. 生成的License Key格式不正确
**可能原因**：
- UUID生成库未正确安装
- 校验码算法实现错误

**解决方案**：
```bash
npm install uuid @types/uuid
```

#### 2. 数据库连接失败
**可能原因**：
- 环境变量未配置
- Supabase项目未创建或配置错误
- 数据库表结构不存在

**解决方案**：
1. 检查`.env.local`文件配置
2. 确认Supabase项目状态
3. 运行数据库初始化SQL脚本

#### 3. 验证测试失败
**可能原因**：
- 验证逻辑实现错误
- 测试用例不正确

**解决方案**：
1. 检查验证器实现代码
2. 查看浏览器控制台错误信息
3. 更新测试用例

## 📊 测试报告示例

### 成功的测试结果应该显示：

```
License Key 生成器测试：
✅ 生成格式：TW-A1B2-C3D4-E5F6-G7H8
✅ 校验码验证：通过
✅ 批量生成：5个唯一密钥

格式验证器测试：
✅ 有效格式识别：TW-A1B2-C3D4-E5F6-G7H8 → 有效
✅ 无效格式拒绝：INVALID-KEY → 无效

输入验证器测试：
✅ License Key有效格式测试：2个用例
✅ License Key无效格式测试：4个用例
✅ 设备ID有效格式测试：2个用例
✅ 设备ID无效格式测试：4个用例
✅ 邮箱有效格式测试：2个用例
✅ 邮箱无效格式测试：3个用例
✅ 激活请求验证测试：完整请求结构

数据库连接测试：
✅ 数据库连接成功！找到 1 条产品记录
```

## 🚨 安全注意事项

1. **测试页面安全**
   - 测试页面已设置`noindex, nofollow`，防止搜索引擎索引
   - 仅在开发环境显示导航链接
   - 不会向生产数据库写入任何数据

2. **敏感信息保护**
   - 测试过程不会暴露真实用户数据
   - 所有测试操作都是只读的
   - 不会发送真实的邮件或创建真实的支付记录

## 📈 性能基准

### 响应时间要求
- License Key生成：< 100ms
- 格式验证：< 10ms（实时验证）
- 数据库连接：< 500ms
- 批量生成5个密钥：< 300ms

## 🔄 持续集成

这个测试页面可以集成到CI/CD流程中：

```yaml
# GitHub Actions 示例
- name: Run License Key Tests
  run: |
    npm run dev &
    sleep 5
    curl -f http://localhost:3000/test-license
    # 可以添加自动化测试脚本
```

## 📞 技术支持

如果在测试过程中遇到问题：

1. 查看浏览器控制台错误信息
2. 检查网络请求状态
3. 验证环境变量配置
4. 参考完整的技术文档：`docs/TECHNICAL_DOCUMENTATION.md`

---

**最后更新**: 2024-08-21  
**版本**: 1.0.0  
**适用于**: TopWindow License Key系统开发和测试