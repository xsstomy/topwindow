# ç¬¬ä¸‰å¤© License Key ç³»ç»Ÿå®æ–½è®¡åˆ’ (æœåŠ¡ç«¯ä¸“æ³¨ç‰ˆ)

## ğŸ“‹ ç›®æ ‡æ¦‚è§ˆ
å®ç°æœåŠ¡ç«¯ License Key ç®¡ç†ç³»ç»Ÿï¼Œå¤„ç†è®¸å¯è¯ç”Ÿæˆã€æ¿€æ´»éªŒè¯ã€è®¾å¤‡ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚

## ğŸ” èŒè´£åˆ’åˆ†æ¾„æ¸…

### æœåŠ¡ç«¯èŒè´£ï¼ˆæœ¬æ¬¡å®æ–½èŒƒå›´ï¼‰
- License Key ç”Ÿæˆå’Œæ ¼å¼éªŒè¯
- å¤„ç†å®¢æˆ·ç«¯æ¿€æ´»è¯·æ±‚
- ç®¡ç†è®¾å¤‡æ¿€æ´»è®°å½•å’Œé™åˆ¶
- æä¾›è®¸å¯è¯éªŒè¯æœåŠ¡
- ç”¨æˆ·è®¸å¯è¯ç®¡ç†ç•Œé¢åç«¯æ”¯æŒ

### å®¢æˆ·ç«¯èŒè´£ï¼ˆä¸åœ¨æœ¬æ¬¡èŒƒå›´ï¼‰
- è®¾å¤‡IDç”Ÿæˆå’ŒæŒä¹…åŒ–ï¼ˆmacOS Hardware UUID/Keychainç­‰ï¼‰
- è°ƒç”¨æœåŠ¡ç«¯API
- æœ¬åœ°è®¸å¯è¯çŠ¶æ€ç®¡ç†

## ğŸ—‚ï¸ å®æ–½æ–‡ä»¶ç»“æ„
```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ license/
â”‚   â”‚   â”œâ”€â”€ generator.ts          # License Key ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ service.ts           # è®¸å¯è¯ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â””â”€â”€ validator.ts         # è®¸å¯è¯æ ¼å¼éªŒè¯
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ validators.ts        # é€šç”¨éªŒè¯å·¥å…·
â”œâ”€â”€ app/api/
â”‚   â””â”€â”€ licenses/
â”‚       â”œâ”€â”€ activate/route.ts    # è®¸å¯è¯æ¿€æ´»API (æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚)
â”‚       â”œâ”€â”€ validate/route.ts    # è®¸å¯è¯éªŒè¯API (å®¢æˆ·ç«¯å®šæœŸè°ƒç”¨)
â”‚       â”œâ”€â”€ my/route.ts         # ç”¨æˆ·è®¸å¯è¯æŸ¥è¯¢API (ä»ªè¡¨æ¿ç”¨)
â”‚       â””â”€â”€ devices/route.ts    # è®¾å¤‡ç®¡ç†API (ä»ªè¡¨æ¿ç”¨)
â””â”€â”€ types/
    â””â”€â”€ license.ts              # License ç›¸å…³ç±»å‹å®šä¹‰
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. License Key ç”Ÿæˆå™¨ (generator.ts)
- UUID åŸºç¡€çš„å¯†é’¥ç”Ÿæˆç®—æ³•
- æ ¡éªŒç è®¡ç®—å’ŒéªŒè¯  
- TW-XXXX-XXXX-XXXX-XXXX æ ¼å¼åŒ–
- æ‰¹é‡ç”Ÿæˆæ”¯æŒï¼ˆæ”¯ä»˜å®Œæˆåä½¿ç”¨ï¼‰

### 2. è®¸å¯è¯æ¿€æ´» API (activate/route.ts)
**è¾“å…¥**ï¼šå®¢æˆ·ç«¯ä¼ æ¥çš„æ¿€æ´»è¯·æ±‚
```typescript
{
  license_key: string,      // ç”¨æˆ·è´­ä¹°çš„è®¸å¯è¯
  device_id: string,        // å®¢æˆ·ç«¯ç”Ÿæˆçš„è®¾å¤‡ID
  device_info: {           // å®¢æˆ·ç«¯æ”¶é›†çš„è®¾å¤‡ä¿¡æ¯
    name: string,
    type: string,
    version?: string
  }
}
```

**å¤„ç†é€»è¾‘**ï¼š
- éªŒè¯è®¸å¯è¯æœ‰æ•ˆæ€§å’ŒçŠ¶æ€
- æ£€æŸ¥æ¿€æ´»è®¾å¤‡æ•°é‡é™åˆ¶
- è®°å½•è®¾å¤‡æ¿€æ´»ä¿¡æ¯
- è¿”å›æ¿€æ´»ç»“æœå’Œåˆ°æœŸæ—¶é—´

### 3. è®¸å¯è¯éªŒè¯ API (validate/route.ts)  
**ç”¨é€”**ï¼šå®¢æˆ·ç«¯å®šæœŸè°ƒç”¨éªŒè¯è®¸å¯è¯çŠ¶æ€
- éªŒè¯ license_key + device_id ç»„åˆ
- æ›´æ–°è®¾å¤‡æœ€åæ´»è·ƒæ—¶é—´
- æ£€æŸ¥è®¸å¯è¯æ˜¯å¦è¿‡æœŸ/æ’¤é”€
- è¿”å›è®¸å¯è¯çŠ¶æ€ä¿¡æ¯

### 4. ç”¨æˆ·è®¸å¯è¯ç®¡ç† API (my/route.ts)
**ç”¨é€”**ï¼šä»ªè¡¨æ¿æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰è®¸å¯è¯
- æŸ¥è¯¢ç”¨æˆ·æ‹¥æœ‰çš„è®¸å¯è¯åˆ—è¡¨
- åŒ…å«æ¯ä¸ªè®¸å¯è¯çš„æ¿€æ´»è®¾å¤‡ä¿¡æ¯
- æ”¯æŒåˆ†é¡µå’Œç­›é€‰

### 5. è®¾å¤‡ç®¡ç† API (devices/route.ts)
**ç”¨é€”**ï¼šä»ªè¡¨æ¿è®¾å¤‡ç®¡ç†åŠŸèƒ½
- æŸ¥çœ‹è®¸å¯è¯å·²æ¿€æ´»çš„è®¾å¤‡åˆ—è¡¨
- æ”¯æŒè®¾å¤‡é‡å‘½å
- è®¾å¤‡æ’¤é”€/åœç”¨åŠŸèƒ½

## â±ï¸ å®æ–½æ—¶é—´å®‰æ’

### ä¸Šåˆ (4å°æ—¶)
1. **åˆ›å»ºç±»å‹å®šä¹‰å’ŒéªŒè¯å·¥å…·** (0.5h)
   - `src/types/license.ts` - Licenseç›¸å…³ç±»å‹
   - `src/lib/utils/validators.ts` - é€šç”¨éªŒè¯å·¥å…·

2. **License Key ç”Ÿæˆå™¨å®ç°** (1h)
   - `src/lib/license/generator.ts` - æ ¸å¿ƒç”Ÿæˆç®—æ³•
   - `src/lib/license/validator.ts` - æ ¼å¼éªŒè¯å™¨

3. **è®¸å¯è¯æœåŠ¡å±‚åŸºç¡€é€»è¾‘** (1.5h)
   - `src/lib/license/service.ts` - ä¸šåŠ¡é€»è¾‘æœåŠ¡

4. **è®¸å¯è¯æ¿€æ´» API å¼€å‘** (1h)
   - `src/app/api/licenses/activate/route.ts`

### ä¸‹åˆ (4å°æ—¶)  
1. **è®¸å¯è¯éªŒè¯ API å¼€å‘** (1h)
   - `src/app/api/licenses/validate/route.ts`

2. **ç”¨æˆ·è®¸å¯è¯æŸ¥è¯¢ API** (1h)
   - `src/app/api/licenses/my/route.ts`

3. **è®¾å¤‡ç®¡ç† API å¼€å‘** (1h)
   - `src/app/api/licenses/devices/route.ts`

4. **API é›†æˆæµ‹è¯•å’Œé”™è¯¯å¤„ç†ä¼˜åŒ–** (1h)
   - é›†æˆæµ‹è¯•ç¼–å†™
   - é”™è¯¯å¤„ç†å®Œå–„

## ğŸ” å…³é”® API æ¥å£è®¾è®¡

### æ¿€æ´»æ¥å£
```
POST /api/licenses/activate
Request: { license_key, device_id, device_info }
Response: { status, message, expires_at, activation_info }
```

### éªŒè¯æ¥å£  
```
POST /api/licenses/validate
Request: { license_key, device_id }
Response: { status, message, license_info, device_info }
```

### æŸ¥è¯¢æ¥å£
```
GET /api/licenses/my
Response: { licenses: [{ license_key, status, devices, created_at }] }
```

### è®¾å¤‡ç®¡ç†æ¥å£
```
GET /api/licenses/devices?license_key=xxx
Response: { devices: [{ device_id, name, type, activated_at, last_seen }] }

PUT /api/licenses/devices/rename
Request: { license_key, device_id, new_name }

DELETE /api/licenses/devices/revoke
Request: { license_key, device_id }
```

## ğŸ§ª æµ‹è¯•éªŒè¯è®¡åˆ’

### License Key ç”Ÿæˆæµ‹è¯•
- æ ¼å¼æ­£ç¡®æ€§éªŒè¯ (TW-XXXX-XXXX-XXXX-XXXX)
- æ ¡éªŒç ç®—æ³•æ­£ç¡®æ€§
- å”¯ä¸€æ€§ä¿è¯æµ‹è¯•

### æ¿€æ´»æµç¨‹æµ‹è¯•
- æœ‰æ•ˆè®¸å¯è¯æ­£å¸¸æ¿€æ´»
- æ— æ•ˆè®¸å¯è¯è¢«æ‹’ç»  
- è®¾å¤‡æ•°é‡é™åˆ¶ç”Ÿæ•ˆ
- é‡å¤æ¿€æ´»åŒä¸€è®¾å¤‡

### éªŒè¯æµç¨‹æµ‹è¯•
- æœ‰æ•ˆç»„åˆé€šè¿‡éªŒè¯
- æ— æ•ˆç»„åˆè¢«æ‹’ç»
- è¿‡æœŸè®¸å¯è¯çŠ¶æ€æ›´æ–°
- è®¾å¤‡æ´»è·ƒæ—¶é—´æ›´æ–°

### è¾¹ç•Œæƒ…å†µæµ‹è¯•
- å¹¶å‘æ¿€æ´»è¯·æ±‚å¤„ç†
- æ¶æ„è¾“å…¥é˜²æŠ¤
- æ•°æ®åº“è¿æ¥å¼‚å¸¸å¤„ç†
- API é™æµæµ‹è¯•

## ğŸ“Š æˆåŠŸæ ‡å‡†

âœ… License Key ç”Ÿæˆå™¨å·¥ä½œæ­£å¸¸ï¼Œæ ¼å¼ç¬¦åˆè§„èŒƒ  
âœ… æ¿€æ´»APIèƒ½æ­£ç¡®å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶è¿”å›å‡†ç¡®ä¿¡æ¯  
âœ… éªŒè¯APIå“åº”è¿…é€Ÿï¼ŒçŠ¶æ€æ›´æ–°åŠæ—¶  
âœ… è®¾å¤‡æ•°é‡é™åˆ¶ä¸¥æ ¼æ‰§è¡Œï¼Œæ— æ³•ç»•è¿‡  
âœ… æ‰€æœ‰APIéƒ½æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¾“å…¥éªŒè¯  
âœ… APIå“åº”æ—¶é—´ < 500msï¼Œæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–  
âœ… RLSå®‰å…¨ç­–ç•¥æ­£ç¡®ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

## ğŸ“ å®æ–½åçš„å‡†å¤‡å·¥ä½œ

ä¸ºç¬¬å››å¤©æ”¯ä»˜å¹³å°é›†æˆåšå‡†å¤‡ï¼š
- License Key è‡ªåŠ¨ç”ŸæˆæœåŠ¡ (æ”¯ä»˜å®Œæˆåè°ƒç”¨)
- é‚®ä»¶é€šçŸ¥æ¥å£ (å‘é€è®¸å¯è¯ç»™ç”¨æˆ·)
- æ”¯ä»˜è®°å½•å…³è” (licenseè¡¨payment_idå­—æ®µ)

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [æŠ€æœ¯å®æ–½æ–‡æ¡£](../TECHNICAL_DOCUMENTATION.md) - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ
- [ç¬¬ä¸€å¤©å®æ–½è®¡åˆ’](DAY1_IMPLEMENTATION_PLAN.md) - åŸºç¡€è®¾æ–½æ­å»º
- [ç¬¬äºŒå¤©å®ŒæˆæŠ¥å‘Š](DAY2_AUTH_COMPLETION_REPORT.md) - è®¤è¯ç³»ç»Ÿå®ç°

---

**åˆ›å»ºæ—¶é—´**: 2024-08-21  
**é¢„è®¡å®Œæˆ**: ç¬¬ä¸‰å¤©ç»“æŸ  
**ä¸‹ä¸€æ­¥**: ç¬¬å››å¤©æ”¯ä»˜å¹³å°é›†æˆ